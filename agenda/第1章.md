# 第1章 リファクタリングーー最初の例
- リファクタリングがどのように行われるのか、リファクタリングの感覚を伝える
- 例示された実装だけで考えない。大きなシステムの一部だと考える

## スタート地点
- 劇団員を派遣して演劇パフォーマンスを行う会社

## 着手前のコメント
- 規模が大きくなると、一つの関数だけでは理解が難しくなる。　
- 汚いコードを変更するのは難しい。どこを変更すべきか、既存コードのへの影響は何かが特定しづらくなるから。それにより、バグを生みやすくなる。
- **機能追加が簡単になるようにリファクタリング -> 新規機能を追加 の順で行うこと。**
  - 長く使われるプログラムで、既存のコードをコピペした場合、次の仕様変更で二つの関数を変更しなければならなくなる。
  - 今後変更があった場合、変更しなければならない箇所は複数になる可能性が高い。
  - プログラムを今後も変更するなら、コードの改善は必要。

## リファクタリングの第一歩
- **最初にすることはテストコードを書くことである。**
- 数秒で結果が出るテストを何度も実行しながら、リファクタリングを行う。
- **テストは実行結果を自己診断する必要がある。**

## statement関数の分割
- 長い関数をリファクタリングする時は、全体を分割できる場所を探す。
- コードについて理解できたことを、頭の中に留めておかない。コードに移動させる。その方法は、意味のあるコードの塊を関数にして、名前をつけること。 -> **「関数の抽出」と呼ぶ**
  - まずスコープ外になる変数がないかを確認。
  - 引数、返却値を決めて、抽出した関数に置き換える。
  - コードを変更したらすぐにテストする。その際、変更は小さく。大きすぎると間違っていた時のデバッグが大変になる。
- 単純に関数を抽出した後、コードをみて変更できる場所を探す。
  - 返却値となる変数の名をわかりやすいもの（result）に変更する。
  - 動的型付け言語では、名前から方がわかるようになっていた方が便利。変数名を適切に変更する。
- **すぐれたプログラマは人間にとってわかりやすいコードを書く**
- 変数の名前を付け替える必要はあるか？ -> ある。変数名はコードを明快にするための鍵。
### play変数の削除
- play変数は削除すべき -> パラメータで渡す必要がないため。
- **「問い合わせによる一次変数の置き換え」を使う。**
- **「変数のインライン化」を行う。**
- **「関数宣言の変更」を行う**
- リファクタリングすることによってパフォーマンスが変わる可能性があるが、今回は影響は大きくない。また、きれいなコードであれば後からチューニングすることは容易。
- ローカル変数を削除すると、メソッドが抽出しやすくなる。
### ボリューム特典ポイントの計算部分の抽出
- 関数に切り出す。その後、関数の引数名を改善（play変数の削除とほぼ同様）。